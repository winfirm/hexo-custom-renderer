/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=function(){function t(e,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=(i||{}).runOnInit,s=void 0!==o&&o;Object.assign(this,{fn:e,timeout:n}),this.set(),s&&e()}var n,i;return n=t,(i=[{key:"set",value:function(){var e=this,t=this.fn,n=this.timeout;this._timer=setTimeout((function(){e.set(),t()}),n)}},{key:"clear",value:function(){clearTimeout(this._timer)}}])&&e(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=new(function(){function e(){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isReestablishing=!1,this._isSlave=!0,this.interval=new t((function(){n._isSlave||n.send({slave:!0})}),1e3),this.interval.set()}var i,o;return i=e,(o=[{key:"connection",get:function(){return this._conn},set:function(e){this._conn=e}},{key:"dispatcher",get:function(){return this._dispatch},set:function(e){this._dispatch=e}},{key:"isSlave",get:function(){return this._isSlave},set:function(e){this._isSlave=e,this.dispatch({isRx:e});var t=document.documentElement;e?t.classList.add("slave"):(t.classList.remove("slave"),this.send({slave:!0}))}},{key:"dispatch",value:function(e){var t=this._dispatch;t&&t.dispatch(e)}},{key:"send",value:function(e){var t=this._conn;t&&t.readyState===t.OPEN&&t.send(JSON.stringify(e))}},{key:"close",value:function(){var e=this._conn;this.interval.clear(),e&&e.close()}},{key:"sendScroll",value:function(){var e={top:window.scrollY/document.body.clientHeight,left:window.scrollX/document.body.clientWidth};this.send({scroll:e})}}])&&n(i.prototype,o),Object.defineProperty(i,"prototype",{writable:!1}),e}());window.addEventListener("beforeunload",(function(){i.close()})),function e(){var t=window.WebSocket||window.MozWebSocket;if(t){var n=new t("ws://".concat(location.host));return i.connection=n,n.onmessage=function(e){(function(e){try{return JSON.parse(e)}catch(e){return console.error(e),{}}})(e.data).change===location.pathname&&location.reload()},n.onopen=function(){i.isReestablishing&&n&&(i.isReestablishing=!1,location.reload())},n.onclose=function(){i.isReestablishing=!0,setTimeout((function(){e()}),500)},n.onerror=function(e){console.log(e)},{send:function(e){return!i.isSlave&&i.send(e)}}}console.error("there is no WebSocket...")}(),document.querySelectorAll("a[href]").forEach((function(e){var t=e.getAttribute("href");/^https?:\/\//.test(t)&&e.setAttribute("target","_blank")}))})();